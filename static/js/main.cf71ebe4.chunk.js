(this["webpackJsonplata2021-front"]=this["webpackJsonplata2021-front"]||[]).push([[0],{14:function(t,e,o){},15:function(t,e,o){},18:function(t,e,o){"use strict";o.r(e);var n,a=o(2),s=o.n(a),i=o(9),r=o.n(i),c=(o(14),o(4)),u=o(5),l=o(3),h=o(7),d=o(6),p=(o(15),o(1)),m=o.n(p),v=(o(16),function(t){Object(h.a)(o,t);var e=Object(d.a)(o);function o(t){var n;return Object(c.a)(this,o),(n=e.call(this,t)).options={color:"rgb(255,255,255)",iconAnchor:new p.Point(0,0),tooltipAnchor:new p.Point(0,0),iconSize:new p.Point(32,48),opacity:1,popupAnchor:new p.Point(0,0),shadowAngle:45,shadowBlur:1,shadowColor:"rgb(0,0,10)",shadowEnable:!1,shadowLength:.75,shadowOpacity:.5,shadowTranslate:new p.Point(0,0),weight:2,className:"svgicon",iconUrl:void 0,svgLink:void 0,interactable:!1},t=p.Util.setOptions(Object(l.a)(n),t),n.options.html=n._createSVG(),n}return Object(u.a)(o,[{key:"_createSVG",value:function(){var t=this,e=document.createElement("object");return e.setAttribute("data",this.options.svgLink),e.addEventListener("load",(function(o){e.style.setProperty("pointer-events","none"),t.options.interactable&&(e.getSVGDocument().querySelector("svg").style.cursor="pointer"),e.getSVGDocument().querySelector("svg").setAttribute("width",t.options.iconSize.x.toString()+"px"),e.getSVGDocument().querySelector("svg").setAttribute("height",t.options.iconSize.y.toString()+"px"),t.setColor(t.options.color)})),e}},{key:"setColor",value:function(t){this.options.color=t;var e=this.options.html.getSVGDocument();if(e){for(var o=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","path"),n=0,a=Object.values(o);n<a.length;n++){var s=a[n];s.hasAttribute("iconColorIgnore")||(s.style.setProperty("fill",t),s.style.setProperty("opacity",this.options.opacity.toString()))}for(var i=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","rect"),r=0,c=Object.values(i);r<c.length;r++){var u=c[r];u.hasAttribute("iconColorIgnore")||(u.style.setProperty("fill",t),u.style.setProperty("opacity",this.options.opacity.toString()))}}}}]),o}(p.DivIcon)),g=o.p+"static/media/marker.5ef2d77e.svg",y=o(0);!function(t){t[t.NONE=0]="NONE",t[t.ROUTE=1]="ROUTE",t[t.TRIP=2]="TRIP",t[t.STOP=3]="STOP"}(n||(n={}));var b=function(t){Object(h.a)(o,t);var e=Object(d.a)(o);function o(t){var a;return Object(c.a)(this,o),(a=e.call(this,t)).map=null,a.lineMap=new Map,a.bus=new p.LayerGroup,a.tram=new p.LayerGroup,a.trolleybus=new p.LayerGroup,a.markerGroup=new p.LayerGroup,a.state={date:new Date("2021-01-01"),hour:(new Date).getHours(),autoHour:!1,currMenu:n.NONE},setInterval(a.updateThing.bind(Object(l.a)(a)),1500),a}return Object(u.a)(o,[{key:"componentDidMount",value:function(){null==this.map&&(this.map=m.a.map("map",{center:[56.95,24.11],maxBounds:[[57.21,23.2],[56.75,24.66]],zoom:13})),m.a.tileLayer("https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={accessToken}",{attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:14,maxZoom:18,subdomains:"abcd",accessToken:"iKbn4srGwDR8o2IxGUP8skNZ8T7AVxUrCiBvpwxYzLLRtSGXGhlY9W20wBr182yM"}).addTo(this.map),this.markerGroup.addTo(this.map),this.setUpRoutes(),this.bus.addTo(this.map),document.getElementById("busCheck").checked=!0}},{key:"setUpRoutes",value:function(){var t=this;fetch("https://busify.herokuapp.com/api/activity/routes?month=".concat(this.state.date.getMonth()+1,"&day=").concat(this.state.date.getDate(),"&hour=").concat(this.state.hour,"&client=true&simpleShape=true"),{mode:"cors",method:"GET"}).then((function(t){return t.json()})).then((function(e){t.bus.clearLayers(),t.tram.clearLayers(),t.trolleybus.clearLayers(),e.forEach((function(e){var o=e.id,n=e.relativeActivity,a=e.longName,s=e.shortName,i=e.type;if(void 0!==e.shape){var r=e.shape;t.showRoute(r,n,"("+s+") "+a+"<br/>"+e.passengers+" passengers",o,i)}}))}))}},{key:"generateStopRoute",value:function(t,e){var o=this;fetch("https://busify.herokuapp.com/api/activity/stops?month=".concat(this.state.date.getMonth()+1,"&day=").concat(this.state.date.getDate(),"&hour=").concat(this.state.hour,"&client=true&route=").concat(t),{mode:"cors",method:"GET"}).then((function(t){return t.json()})).then((function(t){return o.markerGroup.clearLayers(),t.forEach((function(t){new p.Marker(t.coord,{icon:new v({svgLink:g,iconAnchor:[16,16],iconSize:new m.a.Point(32,32),color:o.getColour(t.relativeActivity)})}).bindTooltip("Passengers: "+t.passengers).addTo(o.markerGroup)})),"swag"})).then((function(t){}))}},{key:"paintSegments",value:function(t){var e=this;t.forEach((function(t,o){m.a.polyline(o,{color:e.getColour(t),weight:10,opacity:.5}).addTo(e.map)}))}},{key:"getColour",value:function(t){return"rgb("+255*(1-t)+","+255*t+",0)"}},{key:"changeLight",value:function(t,e){var o=t.split(",");if(3!==o.length)throw new Error("Invalid Colour");o[0]=o[0].substring(4),o[2]=o[2].replace(")","");var n=o.map((function(t){return parseInt(t)}));return e>=0?"rgb(".concat(n[0]*e,",").concat(n[1]*e,",").concat(n[2]*e,")"):"rgb(".concat(n[0]/-e,",").concat(n[1]/-e,",").concat(n[2]/-e,")")}},{key:"onRouteHoverOn",value:function(t){var e=this;this.lineMap.forEach((function(o,n){n!==t&&o.setStyle({color:e.changeLight(e.lineMap.get(n).options.color,-2),opacity:.1})}))}},{key:"onRouteHoverOff",value:function(t){var e=this;this.lineMap.forEach((function(o,n){n!==t&&o.setStyle({color:e.changeLight(e.lineMap.get(n).options.color,2),opacity:.5})}))}},{key:"showRoute",value:function(t,e,o,n,a){var s=this,i=m.a.polyline(t,{color:this.getColour(e),weight:10,opacity:.5}).bindTooltip(o,{sticky:!0});switch(i.addEventListener("mouseover",(function(){s.onRouteHoverOn(n)})).addEventListener("mouseout",(function(){s.onRouteHoverOff(n)})).addEventListener("click",(function(){s.generateStopRoute(n,s.lineMap.get(n))})),this.lineMap.set(n,i),a){case 0:this.bus.addLayer(i);break;case 1:this.trolleybus.addLayer(i);break;case 2:this.tram.addLayer(i)}}},{key:"updateThing",value:function(){this.state.autoHour&&(this.setState({date:this.state.date,hour:this.state.hour+1>23?0:this.state.hour+1,autoHour:this.state.autoHour,currMenu:this.state.currMenu}),this.setUpRoutes())}},{key:"openMenu",value:function(t){var e,o,a,s,i,r,c,u,l,h,d,p;switch(this.state.currMenu){case n.ROUTE:null===(e=document.getElementById("routeList"))||void 0===e||e.classList.remove("listOpen"),null===(o=document.getElementById("routeList"))||void 0===o||o.classList.add("listClose");break;case n.TRIP:null===(a=document.getElementById("tripList"))||void 0===a||a.classList.remove("listOpen"),null===(s=document.getElementById("tripList"))||void 0===s||s.classList.add("listClose");break;case n.STOP:null===(i=document.getElementById("stopList"))||void 0===i||i.classList.remove("listOpen"),null===(r=document.getElementById("stopList"))||void 0===r||r.classList.add("listClose")}if(t!==this.state.currMenu){switch(t){case n.ROUTE:null===(c=document.getElementById("routeList"))||void 0===c||c.classList.remove("listClose"),null===(u=document.getElementById("routeList"))||void 0===u||u.classList.add("listOpen");break;case n.TRIP:null===(l=document.getElementById("tripList"))||void 0===l||l.classList.remove("listClose"),null===(h=document.getElementById("tripList"))||void 0===h||h.classList.add("listOpen");break;case n.STOP:null===(d=document.getElementById("stopList"))||void 0===d||d.classList.remove("listClose"),null===(p=document.getElementById("stopList"))||void 0===p||p.classList.add("listOpen")}this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:t})}else this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:n.NONE})}},{key:"render",value:function(){var t=this;return Object(y.jsxs)("div",{className:"App",children:[Object(y.jsx)("div",{id:"map"}),Object(y.jsxs)("div",{id:"GUI",children:[Object(y.jsx)("input",{type:"date",id:"selectDate",min:"2021-01-01",max:"2021-01-31",value:this.state.date.toISOString().split("T")[0],onChange:function(e){t.setState({date:new Date(e.target.value),hour:t.state.hour,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(y.jsxs)("h1",{id:"time",children:[this.state.hour,":00"]}),Object(y.jsx)("input",{type:"checkbox",id:"autoHour",value:this.state.autoHour,onChange:function(e){t.setState({date:t.state.date,hour:t.state.hour,autoHour:e.target.checked,currMenu:t.state.currMenu})}}),Object(y.jsx)("input",{type:"range",id:"selectHour",min:0,max:23,value:this.state.hour,onChange:function(e){t.setState({date:t.state.date,hour:e.target.valueAsNumber,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(y.jsxs)("div",{id:"transportTypes",children:["Bus ",Object(y.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.bus.addTo(t.map):t.bus.removeFrom(t.map),t.markerGroup.clearLayers()},id:"busCheck"}),Object(y.jsx)("br",{}),"Tram ",Object(y.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.tram.addTo(t.map):t.tram.removeFrom(t.map),t.markerGroup.clearLayers()}}),Object(y.jsx)("br",{}),"Trolleybus ",Object(y.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.trolleybus.addTo(t.map):t.trolleybus.removeFrom(t.map),t.markerGroup.clearLayers()}}),Object(y.jsx)("br",{})]}),Object(y.jsxs)("div",{id:"routeList",className:"listClose",children:[Object(y.jsx)("input",{id:"routeDrawer",value:"R\nO\nU\nT\nE\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(n.ROUTE)}}),Object(y.jsx)("div",{id:"actualRouteList"})]}),Object(y.jsxs)("div",{id:"tripList",className:"listClose",children:[Object(y.jsx)("input",{id:"tripDrawer",value:"T\nR\nI\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(n.TRIP)}}),Object(y.jsx)("div",{id:"actualTripList"})]}),Object(y.jsxs)("div",{id:"stopList",className:"listClose",children:[Object(y.jsx)("input",{id:"stopDrawer",value:"S\nT\nO\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(n.STOP)}}),Object(y.jsx)("div",{id:"actualStopList"})]})]})]})}}]),o}(s.a.Component),f=function(t){t&&t instanceof Function&&o.e(3).then(o.bind(null,19)).then((function(e){var o=e.getCLS,n=e.getFID,a=e.getFCP,s=e.getLCP,i=e.getTTFB;o(t),n(t),a(t),s(t),i(t)}))};r.a.render(Object(y.jsx)(s.a.StrictMode,{children:Object(y.jsx)(b,{})}),document.getElementById("root")),f()}},[[18,1,2]]]);
//# sourceMappingURL=main.cf71ebe4.chunk.js.map