(this["webpackJsonplata2021-front"]=this["webpackJsonplata2021-front"]||[]).push([[0],{14:function(t,e,s){},15:function(t,e,s){},17:function(t,e,s){"use strict";s.r(e);var a,o=s(2),n=s.n(o),i=s(5),r=s.n(i),u=(s(14),s(6)),c=s(7),l=s(3),d=s(9),h=s(8),p=(s(15),s(1)),m=s.n(p),v=s(0);!function(t){t[t.NONE=0]="NONE",t[t.ROUTE=1]="ROUTE",t[t.TRIP=2]="TRIP",t[t.STOP=3]="STOP"}(a||(a={}));var b=function(t){Object(d.a)(s,t);var e=Object(h.a)(s);function s(t){var o;return Object(u.a)(this,s),(o=e.call(this,t)).map=null,o.lineMap=new Map,o.bus=new p.LayerGroup,o.tram=new p.LayerGroup,o.trolleybus=new p.LayerGroup,o.state={date:new Date("2021-01-01"),hour:(new Date).getHours(),autoHour:!1,currMenu:a.NONE},setInterval(o.updateThing.bind(Object(l.a)(o)),1500),o}return Object(c.a)(s,[{key:"componentDidMount",value:function(){null==this.map&&(this.map=m.a.map("map",{center:[56.95,24.11],maxBounds:[[57.21,23.2],[56.75,24.66]],zoom:13})),m.a.tileLayer("https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={accessToken}",{attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:14,maxZoom:18,subdomains:"abcd",accessToken:"iKbn4srGwDR8o2IxGUP8skNZ8T7AVxUrCiBvpwxYzLLRtSGXGhlY9W20wBr182yM"}).addTo(this.map),this.setUpRoutes()}},{key:"setUpRoutes",value:function(){var t=this;fetch("https://busify.herokuapp.com/api/activity/routes?month=".concat(this.state.date.getMonth()+1,"&day=").concat(this.state.date.getDate(),"&hour=").concat(this.state.hour,"&client=true&simpleShape=true"),{method:"GET"}).then((function(t){return t.json()})).then((function(e){t.bus.clearLayers(),t.tram.clearLayers(),t.trolleybus.clearLayers(),e.forEach((function(e){var s=e.routeId,a=e.relativeActivity,o=e.longName,n=e.shortName,i=e.type;if(void 0!==e.shape){var r=e.shape;t.showRoute(r,a,"("+n+") "+o+"<br/>"+e.passengers+" passengers",s,i)}}))}))}},{key:"paintSegments",value:function(t){var e=this;t.forEach((function(t,s){m.a.polyline(s,{color:e.getColour(t),weight:10,opacity:.5}).addTo(e.map)}))}},{key:"getColour",value:function(t){return"rgb("+255*(1-t)+","+255*t+",0)"}},{key:"changeLight",value:function(t,e){var s=t.split(",");if(3!==s.length)throw new Error("Invalid Colour");s[0]=s[0].substring(4),s[2]=s[2].replace(")","");var a=s.map((function(t){return parseInt(t)}));return e>=0?"rgb(".concat(a[0]*e,",").concat(a[1]*e,",").concat(a[2]*e,")"):"rgb(".concat(a[0]/-e,",").concat(a[1]/-e,",").concat(a[2]/-e,")")}},{key:"onRouteHoverOn",value:function(t){var e=this;this.lineMap.forEach((function(s,a){a!==t&&s.setStyle({color:e.changeLight(e.lineMap.get(a).options.color,-2)})}))}},{key:"onRouteHoverOff",value:function(t){var e=this;this.lineMap.forEach((function(s,a){a!==t&&s.setStyle({color:e.changeLight(e.lineMap.get(a).options.color,2)})}))}},{key:"showRoute",value:function(t,e,s,a,o){var n=this,i=m.a.polyline(t,{color:this.getColour(e),weight:10,opacity:.5}).bindTooltip(s,{sticky:!0});switch(i.addEventListener("mouseover",(function(){n.onRouteHoverOn(a)})).addEventListener("mouseout",(function(){n.onRouteHoverOff(a)})),this.lineMap.set(a,i),o){case 0:this.bus.addLayer(i);break;case 1:this.trolleybus.addLayer(i);break;case 2:this.tram.addLayer(i)}}},{key:"updateThing",value:function(){this.state.autoHour&&(this.setState({date:this.state.date,hour:this.state.hour+1>23?0:this.state.hour+1,autoHour:this.state.autoHour,currMenu:this.state.currMenu}),this.setUpRoutes())}},{key:"openMenu",value:function(t){var e,s,o,n,i,r,u,c,l,d,h,p;switch(this.state.currMenu){case a.ROUTE:null===(e=document.getElementById("routeList"))||void 0===e||e.classList.remove("listOpen"),null===(s=document.getElementById("routeList"))||void 0===s||s.classList.add("listClose");break;case a.TRIP:null===(o=document.getElementById("tripList"))||void 0===o||o.classList.remove("listOpen"),null===(n=document.getElementById("tripList"))||void 0===n||n.classList.add("listClose");break;case a.STOP:null===(i=document.getElementById("stopList"))||void 0===i||i.classList.remove("listOpen"),null===(r=document.getElementById("stopList"))||void 0===r||r.classList.add("listClose")}if(t!==this.state.currMenu){switch(t){case a.ROUTE:null===(u=document.getElementById("routeList"))||void 0===u||u.classList.remove("listClose"),null===(c=document.getElementById("routeList"))||void 0===c||c.classList.add("listOpen");break;case a.TRIP:null===(l=document.getElementById("tripList"))||void 0===l||l.classList.remove("listClose"),null===(d=document.getElementById("tripList"))||void 0===d||d.classList.add("listOpen");break;case a.STOP:null===(h=document.getElementById("stopList"))||void 0===h||h.classList.remove("listClose"),null===(p=document.getElementById("stopList"))||void 0===p||p.classList.add("listOpen")}this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:t})}else this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:a.NONE})}},{key:"render",value:function(){var t=this;return Object(v.jsxs)("div",{className:"App",children:[Object(v.jsx)("div",{id:"map"}),Object(v.jsxs)("div",{id:"GUI",children:[Object(v.jsx)("input",{type:"date",id:"selectDate",min:"2021-01-01",max:"2021-01-31",value:this.state.date.toISOString().split("T")[0],onChange:function(e){t.setState({date:new Date(e.target.value),hour:t.state.hour,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(v.jsxs)("h1",{id:"time",children:[this.state.hour,":00"]}),Object(v.jsx)("input",{type:"checkbox",id:"autoHour",value:this.state.autoHour,onChange:function(e){t.setState({date:t.state.date,hour:t.state.hour,autoHour:e.target.checked,currMenu:t.state.currMenu})}}),Object(v.jsx)("input",{type:"range",id:"selectHour",min:0,max:23,value:this.state.hour,onChange:function(e){t.setState({date:t.state.date,hour:e.target.valueAsNumber,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(v.jsxs)("div",{id:"transportTypes",children:["Bus ",Object(v.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.bus.addTo(t.map):t.bus.removeFrom(t.map)}}),Object(v.jsx)("br",{}),"Tram ",Object(v.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.tram.addTo(t.map):t.tram.removeFrom(t.map)}}),Object(v.jsx)("br",{}),"Trolleybus ",Object(v.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.trolleybus.addTo(t.map):t.trolleybus.removeFrom(t.map)}}),Object(v.jsx)("br",{})]}),Object(v.jsxs)("div",{id:"routeList",className:"listClose",children:[Object(v.jsx)("input",{id:"routeDrawer",value:"R\nO\nU\nT\nE\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.ROUTE)}}),Object(v.jsx)("div",{id:"actualRouteList"})]}),Object(v.jsxs)("div",{id:"tripList",className:"listClose",children:[Object(v.jsx)("input",{id:"tripDrawer",value:"T\nR\nI\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.TRIP)}}),Object(v.jsx)("div",{id:"actualTripList"})]}),Object(v.jsxs)("div",{id:"stopList",className:"listClose",children:[Object(v.jsx)("input",{id:"stopDrawer",value:"S\nT\nO\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.STOP)}}),Object(v.jsx)("div",{id:"actualStopList"})]})]})]})}}]),s}(n.a.Component),g=function(t){t&&t instanceof Function&&s.e(3).then(s.bind(null,18)).then((function(e){var s=e.getCLS,a=e.getFID,o=e.getFCP,n=e.getLCP,i=e.getTTFB;s(t),a(t),o(t),n(t),i(t)}))};r.a.render(Object(v.jsx)(n.a.StrictMode,{children:Object(v.jsx)(b,{})}),document.getElementById("root")),g()}},[[17,1,2]]]);
//# sourceMappingURL=main.dfd78c5e.chunk.js.map