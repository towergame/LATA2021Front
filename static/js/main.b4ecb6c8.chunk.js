(this["webpackJsonplata2021-front"]=this["webpackJsonplata2021-front"]||[]).push([[0],{15:function(t,e,n){},16:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var a,o=n(2),s=n.n(o),i=n(6),r=n.n(i),u=(n(15),n(5)),c=n(7),l=n(8),d=n(3),h=n(10),p=n(9),m=(n(16),n(1)),v=n.n(m),b=n(0);!function(t){t[t.NONE=0]="NONE",t[t.ROUTE=1]="ROUTE",t[t.TRIP=2]="TRIP",t[t.STOP=3]="STOP"}(a||(a={}));var g=function(t){Object(h.a)(n,t);var e=Object(p.a)(n);function n(t){var o;return Object(c.a)(this,n),(o=e.call(this,t)).map=null,o.lineMap=new Map,o.bus=new m.LayerGroup,o.tram=new m.LayerGroup,o.trolleybus=new m.LayerGroup,o.state={date:new Date("2021-01-01"),hour:(new Date).getHours(),autoHour:!1,currMenu:a.NONE},setInterval(o.updateThing.bind(Object(d.a)(o)),1500),o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){null==this.map&&(this.map=v.a.map("map",{center:[56.95,24.11],maxBounds:[[57.21,23.2],[56.75,24.66]],zoom:13})),v.a.tileLayer("https://{s}.tile.jawg.io/jawg-dark/{z}/{x}/{y}{r}.png?access-token={accessToken}",{attribution:'<a href="http://jawg.io" title="Tiles Courtesy of Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:14,maxZoom:18,subdomains:"abcd",accessToken:"iKbn4srGwDR8o2IxGUP8skNZ8T7AVxUrCiBvpwxYzLLRtSGXGhlY9W20wBr182yM"}).addTo(this.map),this.setUpRoutes()}},{key:"setUpRoutes",value:function(){var t=this;fetch("https://busify.herokuapp.com/api/activity/routes?month=".concat(this.state.date.getMonth()+1,"&day=").concat(this.state.date.getDate(),"&hour=").concat(this.state.hour,"&client=true&simpleShape=true"),{mode:"cors",method:"GET"}).then((function(t){return t.json()})).then((function(e){t.bus.clearLayers(),t.tram.clearLayers(),t.trolleybus.clearLayers(),e.forEach((function(e){var n=e.id,a=e.relativeActivity,o=e.longName,s=e.shortName,i=e.type;if(void 0!==e.shape){var r=e.shape;t.showRoute(r,a,"("+s+") "+o+"<br/>"+e.passengers+" passengers",n,i)}}))}))}},{key:"generateStopRoute",value:function(t,e){var n=this,a=[],o=[];fetch("http://busify.herokuapp.com/api/activity/stops?month=".concat(this.state.date.getMonth()+1,"&day=").concat(this.state.date.getDate(),"&hour=").concat(this.state.hour,"&client=true&route=").concat(t),{mode:"cors",method:"GET"}).then((function(t){return t.json()})).then((function(t){return t.forEach((function(t){a.push(t.coord),o.push(t.relativeActivity)})),"swag"})).then((function(t){for(var s=new Map,i=e.getLatLngs(),r=function(t){for(var r=n.map.layerPointToLatLng(e.closestLayerPoint(n.map.latLngToLayerPoint(a[t+1]))),c=n.map.layerPointToLatLng(e.closestLayerPoint(n.map.latLngToLayerPoint(a[t+1]))),l=[],d=i.indexOf(Object(u.a)(i).sort((function(t,e){return r.distanceTo(t)-r.distanceTo(e)}))[0]);d<i.indexOf(Object(u.a)(i).sort((function(t,e){return c.distanceTo(t)-c.distanceTo(e)}))[0])+1;d++)l.push(i[d]);s.set(l,o[t])},c=0;c<a.length-1;c++)r(c);n.paintSegments(s)}))}},{key:"paintSegments",value:function(t){var e=this;t.forEach((function(t,n){v.a.polyline(n,{color:e.getColour(t),weight:10,opacity:.5}).addTo(e.map)}))}},{key:"getColour",value:function(t){return"rgb("+255*(1-t)+","+255*t+",0)"}},{key:"changeLight",value:function(t,e){var n=t.split(",");if(3!==n.length)throw new Error("Invalid Colour");n[0]=n[0].substring(4),n[2]=n[2].replace(")","");var a=n.map((function(t){return parseInt(t)}));return e>=0?"rgb(".concat(a[0]*e,",").concat(a[1]*e,",").concat(a[2]*e,")"):"rgb(".concat(a[0]/-e,",").concat(a[1]/-e,",").concat(a[2]/-e,")")}},{key:"onRouteHoverOn",value:function(t){var e=this;this.lineMap.forEach((function(n,a){a!==t&&n.setStyle({color:e.changeLight(e.lineMap.get(a).options.color,-2)})}))}},{key:"onRouteHoverOff",value:function(t){var e=this;this.lineMap.forEach((function(n,a){a!==t&&n.setStyle({color:e.changeLight(e.lineMap.get(a).options.color,2)})}))}},{key:"showRoute",value:function(t,e,n,a,o){var s=this,i=v.a.polyline(t,{color:this.getColour(e),weight:10,opacity:.5}).bindTooltip(n,{sticky:!0});switch(i.addEventListener("mouseover",(function(){s.onRouteHoverOn(a)})).addEventListener("mouseout",(function(){s.onRouteHoverOff(a)})),this.lineMap.set(a,i),o){case 0:this.bus.addLayer(i);break;case 1:this.trolleybus.addLayer(i);break;case 2:this.tram.addLayer(i)}}},{key:"updateThing",value:function(){this.state.autoHour&&(this.setState({date:this.state.date,hour:this.state.hour+1>23?0:this.state.hour+1,autoHour:this.state.autoHour,currMenu:this.state.currMenu}),this.setUpRoutes())}},{key:"openMenu",value:function(t){var e,n,o,s,i,r,u,c,l,d,h,p;switch(this.state.currMenu){case a.ROUTE:null===(e=document.getElementById("routeList"))||void 0===e||e.classList.remove("listOpen"),null===(n=document.getElementById("routeList"))||void 0===n||n.classList.add("listClose");break;case a.TRIP:null===(o=document.getElementById("tripList"))||void 0===o||o.classList.remove("listOpen"),null===(s=document.getElementById("tripList"))||void 0===s||s.classList.add("listClose");break;case a.STOP:null===(i=document.getElementById("stopList"))||void 0===i||i.classList.remove("listOpen"),null===(r=document.getElementById("stopList"))||void 0===r||r.classList.add("listClose")}if(t!==this.state.currMenu){switch(t){case a.ROUTE:null===(u=document.getElementById("routeList"))||void 0===u||u.classList.remove("listClose"),null===(c=document.getElementById("routeList"))||void 0===c||c.classList.add("listOpen");break;case a.TRIP:null===(l=document.getElementById("tripList"))||void 0===l||l.classList.remove("listClose"),null===(d=document.getElementById("tripList"))||void 0===d||d.classList.add("listOpen");break;case a.STOP:null===(h=document.getElementById("stopList"))||void 0===h||h.classList.remove("listClose"),null===(p=document.getElementById("stopList"))||void 0===p||p.classList.add("listOpen")}this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:t})}else this.setState({date:this.state.date,hour:this.state.hour,autoHour:this.state.autoHour,currMenu:a.NONE})}},{key:"render",value:function(){var t=this;return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)("div",{id:"map"}),Object(b.jsxs)("div",{id:"GUI",children:[Object(b.jsx)("input",{type:"date",id:"selectDate",min:"2021-01-01",max:"2021-01-31",value:this.state.date.toISOString().split("T")[0],onChange:function(e){t.setState({date:new Date(e.target.value),hour:t.state.hour,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(b.jsxs)("h1",{id:"time",children:[this.state.hour,":00"]}),Object(b.jsx)("input",{type:"checkbox",id:"autoHour",value:this.state.autoHour,onChange:function(e){t.setState({date:t.state.date,hour:t.state.hour,autoHour:e.target.checked,currMenu:t.state.currMenu})}}),Object(b.jsx)("input",{type:"range",id:"selectHour",min:0,max:23,value:this.state.hour,onChange:function(e){t.setState({date:t.state.date,hour:e.target.valueAsNumber,autoHour:t.state.autoHour,currMenu:t.state.currMenu}),t.setUpRoutes()}}),Object(b.jsxs)("div",{id:"transportTypes",children:["Bus ",Object(b.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.bus.addTo(t.map):t.bus.removeFrom(t.map)}}),Object(b.jsx)("br",{}),"Tram ",Object(b.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.tram.addTo(t.map):t.tram.removeFrom(t.map)}}),Object(b.jsx)("br",{}),"Trolleybus ",Object(b.jsx)("input",{type:"checkbox",onChange:function(e){e.target.checked?t.trolleybus.addTo(t.map):t.trolleybus.removeFrom(t.map)}}),Object(b.jsx)("br",{})]}),Object(b.jsxs)("div",{id:"routeList",className:"listClose",children:[Object(b.jsx)("input",{id:"routeDrawer",value:"R\nO\nU\nT\nE\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.ROUTE)}}),Object(b.jsx)("div",{id:"actualRouteList"})]}),Object(b.jsxs)("div",{id:"tripList",className:"listClose",children:[Object(b.jsx)("input",{id:"tripDrawer",value:"T\nR\nI\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.TRIP)}}),Object(b.jsx)("div",{id:"actualTripList"})]}),Object(b.jsxs)("div",{id:"stopList",className:"listClose",children:[Object(b.jsx)("input",{id:"stopDrawer",value:"S\nT\nO\nP\nS",type:"button",hidden:!0,onClick:function(){t.openMenu(a.STOP)}}),Object(b.jsx)("div",{id:"actualStopList"})]})]})]})}}]),n}(s.a.Component),y=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,19)).then((function(e){var n=e.getCLS,a=e.getFID,o=e.getFCP,s=e.getLCP,i=e.getTTFB;n(t),a(t),o(t),s(t),i(t)}))};r.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(g,{})}),document.getElementById("root")),y()}},[[18,1,2]]]);
//# sourceMappingURL=main.b4ecb6c8.chunk.js.map